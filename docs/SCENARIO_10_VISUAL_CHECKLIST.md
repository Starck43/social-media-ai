# ✅ Сценарий #10: Визуальный чек-лист настройки

**URL**: http://localhost:8000/admin/bot-scenario/edit/10

---

## 📝 Пошаговая инструкция с чек-листом

### Шаг 1: Основная информация

```
┌─────────────────────────────────────────────────┐
│ Name                                            │
│ ┌─────────────────────────────────────────────┐ │
│ │ Мониторинг активности пользователя          │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Скопировано: `Мониторинг активности пользователя`

```
┌─────────────────────────────────────────────────┐
│ Description                                     │
│ ┌─────────────────────────────────────────────┐ │
│ │ Отслеживает все действия пользователя в     │ │
│ │ соцсети: публикации постов, комментарии в   │ │
│ │ других группах, лайки и реакции...          │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Скопировано полное описание из `SCENARIO_10_QUICK_COPY_PASTE.md`

---

### Шаг 2: Content Types (JSON)

```
┌─────────────────────────────────────────────────┐
│ Content Types                                   │
│ ┌─────────────────────────────────────────────┐ │
│ │ ["posts", "comments", "reactions"]          │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Вставлен JSON: `["posts", "comments", "reactions"]`
- [ ] Проверено: синтаксис JSON правильный (кавычки, запятые)

**Важно**: Если есть checkboxes вместо JSON:
- [ ] ✅ posts
- [ ] ✅ comments
- [ ] ✅ reactions

---

### Шаг 3: Analysis Types (JSON)

```
┌─────────────────────────────────────────────────┐
│ Analysis Types                                  │
│ ┌─────────────────────────────────────────────┐ │
│ │ ["sentiment", "keywords", "topics"]         │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Вставлен JSON: `["sentiment", "keywords", "topics"]`

**Важно**: Если есть checkboxes:
- [ ] ✅ sentiment
- [ ] ✅ keywords
- [ ] ✅ topics

---

### Шаг 4: Scope (КРИТИЧЕСКИ ВАЖНО)

```
┌─────────────────────────────────────────────────┐
│ Scope                                           │
│ ┌─────────────────────────────────────────────┐ │
│ │ {                                           │ │
│ │   "event_based": true,                      │ │
│ │   "max_events_per_analysis": 50,            │ │
│ │   "include_target_info": true,              │ │
│ │   "annotation_length": "brief",             │ │
│ │   "group_by": "day"                         │ │
│ │ }                                           │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Вставлен JSON со всеми полями
- [ ] **Проверено**: `"event_based": true` присутствует
- [ ] Синтаксис JSON корректный

**Почему важно**: Флаг `event_based: true` переключает анализатор в режим детализации по событиям.

---

### Шаг 5: Text Prompt (САМОЕ ВАЖНОЕ)

```
┌─────────────────────────────────────────────────┐
│ Text Prompt                                     │
│ ┌─────────────────────────────────────────────┐ │
│ │ Ты - аналитик социальных сетей.             │ │
│ │ Проанализируй активность пользователя...    │ │
│ │                                             │ │
│ │ [... ПОЛНЫЙ ПРОМПТ ...]                     │ │
│ │                                             │ │
│ │ ВАЖНО:                                      │ │
│ │ - Анонс должен быть САМОДОСТАТОЧНЫМ         │ │
│ │ - Длина: 1-2 предложения (макс 150 симв)   │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Скопирован **ПОЛНЫЙ** промпт из `SCENARIO_10_QUICK_COPY_PASTE.md`
- [ ] Проверено: промпт содержит примеры (✅ хороший анонс, ❌ плохой анонс)
- [ ] Проверено: промпт содержит структуру JSON для ответа
- [ ] Проверено: упомянуты переменные `{text}`, `{platform}`, `{date_range}`

**Размер промпта**: ~3000 символов (это нормально, не сокращать!)

---

### Шаг 6: Image/Video/Audio Prompts

```
┌─────────────────────────────────────────────────┐
│ Image Prompt                                    │
│ ┌─────────────────────────────────────────────┐ │
│ │ Опиши изображение, которое опубликовал...   │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Image Prompt скопирован
- [ ] Video Prompt скопирован
- [ ] Audio Prompt скопирован

---

### Шаг 7: Unified Summary Prompt

```
┌─────────────────────────────────────────────────┐
│ Unified Summary Prompt                          │
│ ┌─────────────────────────────────────────────┐ │
│ │ Создай итоговое резюме активности...        │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Unified Summary Prompt скопирован

---

### Шаг 8: Trigger Settings

```
┌─────────────────────────────────────────────────┐
│ Trigger Type                                    │
│ ┌─────────────────────────────────────────────┐ │
│ │ ▼ ALWAYS                                    │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Выбрано: **ALWAYS**

```
┌─────────────────────────────────────────────────┐
│ Trigger Config                                  │
│ ┌─────────────────────────────────────────────┐ │
│ │ {}                                          │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Вставлено: `{}`

---

### Шаг 9: Action Settings

```
┌─────────────────────────────────────────────────┐
│ Action Type                                     │
│ ┌─────────────────────────────────────────────┐ │
│ │ ▼ NONE                                      │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Выбрано: **NONE** (только анализ, без действий)

---

### Шаг 10: LLM Providers

```
┌─────────────────────────────────────────────────┐
│ Text LLM Provider                               │
│ ┌─────────────────────────────────────────────┐ │
│ │ ▼ [Выбрать провайдер]                       │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Text LLM Provider выбран (например, OpenAI GPT-4)

```
┌─────────────────────────────────────────────────┐
│ Image LLM Provider                              │
│ ┌─────────────────────────────────────────────┐ │
│ │ ▼ [Выбрать провайдер с vision]              │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Image LLM Provider выбран (GPT-4V или аналог)

```
┌─────────────────────────────────────────────────┐
│ Video LLM Provider                              │
│ ┌─────────────────────────────────────────────┐ │
│ │ ▼ [Выбрать провайдер с vision]              │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Video LLM Provider выбран

```
┌─────────────────────────────────────────────────┐
│ Audio LLM Provider                              │
│ ┌─────────────────────────────────────────────┐ │
│ │ ▼ [Выбрать провайдер с audio]               │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Audio LLM Provider выбран (Whisper или аналог)

```
┌─────────────────────────────────────────────────┐
│ Unified LLM Provider                            │
│ ┌─────────────────────────────────────────────┐ │
│ │ ▼ [Тот же, что Text LLM Provider]           │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Unified LLM Provider выбран (тот же, что для текста)

---

### Шаг 11: Active & Interval

```
┌─────────────────────────────────────────────────┐
│ Is Active                                       │
│ ┌─────────────────────────────────────────────┐ │
│ │ ✅ True                                      │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Отмечено: **TRUE**

```
┌─────────────────────────────────────────────────┐
│ Collection Interval Hours                       │
│ ┌─────────────────────────────────────────────┐ │
│ │ 1                                           │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```
- [ ] Установлено: **1**

---

### Шаг 12: SAVE!

```
┌─────────────────────────────────────────────────┐
│                                                 │
│               [💾 SAVE]                         │
│                                                 │
└─────────────────────────────────────────────────┘
```
- [ ] Нажата кнопка **SAVE**
- [ ] Проверено: сообщение об успешном сохранении

---

## ✅ Итоговый чек-лист перед SAVE

### Обязательные поля:
- [ ] **Name**: Заполнено
- [ ] **Content Types**: `["posts", "comments", "reactions"]`
- [ ] **Analysis Types**: `["sentiment", "keywords", "topics"]`
- [ ] **Scope**: `{"event_based": true, ...}`
- [ ] **Text Prompt**: ПОЛНЫЙ промпт (~3000 символов)
- [ ] **Trigger Type**: ALWAYS
- [ ] **Action Type**: NONE
- [ ] **Text LLM Provider**: Выбран
- [ ] **Is Active**: TRUE
- [ ] **Collection Interval Hours**: 1

### Желательные поля:
- [ ] **Description**: Заполнено
- [ ] **Image Prompt**: Заполнено (если планируется анализ изображений)
- [ ] **Video Prompt**: Заполнено (если планируется анализ видео)
- [ ] **Unified Summary Prompt**: Заполнено
- [ ] **Image/Video/Audio LLM Providers**: Выбраны

---

## 🚨 Частые ошибки

### ❌ Ошибка 1: Scope пустой или без event_based
```json
{}  // НЕПРАВИЛЬНО!
```
**Исправить**:
```json
{
  "event_based": true,
  "max_events_per_analysis": 50
}
```

### ❌ Ошибка 2: Text Prompt слишком короткий
```
Проанализируй активность пользователя.  // НЕПРАВИЛЬНО!
```
**Исправить**: Использовать ПОЛНЫЙ промпт с примерами и структурой JSON

### ❌ Ошибка 3: Content Types неполные
```json
["posts"]  // НЕПРАВИЛЬНО! Пропущены comments и reactions
```
**Исправить**:
```json
["posts", "comments", "reactions"]
```

### ❌ Ошибка 4: Trigger Type не выбран
```
NULL  // НЕПРАВИЛЬНО!
```
**Исправить**: Выбрать **ALWAYS**

### ❌ Ошибка 5: Is Active = FALSE
```
False ❌  // Сценарий не будет работать!
```
**Исправить**: **TRUE ✅**

---

## 🎯 После сохранения

### Шаг 13: Создать Source для пользователя

1. Перейти: http://localhost:8000/admin/source/create

2. Заполнить:
```
┌─────────────────────────────────────────────────┐
│ Platform: ▼ ВКонтакте                           │
│ Type: ▼ USER                                    │
│ External ID: 12345                              │
│ Name: Иванов Иван                               │
│ Bot Scenario: ▼ #10 Мониторинг активности...   │
└─────────────────────────────────────────────────┘
```

3. Params:
```json
{
  "collection": {
    "count": 100
  }
}
```

- [ ] Source создан
- [ ] Привязан к сценарию #10

### Шаг 14: Запустить

```bash
python cli/scheduler.py run --source-id <ID_СОЗДАННОГО_ИСТОЧНИКА>
```

- [ ] Команда выполнена
- [ ] В логах нет ошибок

### Шаг 15: Проверить результат

1. Открыть: http://localhost:8000/dashboard/topic-chains

2. Найти цепочку: `source_<ID>_scenario_10`

3. Проверить:
   - [ ] Цепочка создана
   - [ ] Есть хотя бы один анализ
   - [ ] События отображаются с аннотациями
   - [ ] Sentiment и keywords заполнены

---

## 📊 Пример успешного результата

```
┌─────────────────────────────────────────────────┐
│ ✨ Активность пользователя за 18 октября        │
│                                                 │
│ 📅 18 окт - 18 окт | 📊 1 анализ                │
│ 🔄 18 окт, 14:30                                │
│                                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                 │
│ 18 окт, 10:30                                   │
│                                                 │
│ 📝 post                                         │
│ Опубликовал пост о новом дизайне приложения,    │
│ поделившись впечатлениями и результатами работы │
│ 😊 Позитивный | дизайн, проект, работа          │
│                                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                 │
│ 18 окт, 11:45                                   │
│                                                 │
│ 💬 comment                                      │
│ Поддержал мнение о улучшении навигации в        │
│ комментарии под постом в группе UX Designers    │
│ 😊 Позитивный | навигация, UX, улучшение        │
│ 🔗 vk.com/wall-98765_54321                      │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

## 🆘 Troubleshooting

### Проблема: События не отображаются

**Причина**: Scope не содержит `"event_based": true`

**Решение**:
1. Вернуться в http://localhost:8000/admin/bot-scenario/edit/10
2. Проверить Scope
3. Добавить `"event_based": true`
4. SAVE

### Проблема: Анонсы слишком длинные

**Причина**: Промпт не содержит примеры или ограничения

**Решение**:
1. Скопировать ПОЛНЫЙ промпт из `SCENARIO_10_QUICK_COPY_PASTE.md`
2. Убедиться, что есть секция с примерами ✅❌
3. SAVE

### Проблема: Нет данных о target (где произошло)

**Причина**: Scope не содержит `"include_target_info": true`

**Решение**:
1. Добавить в Scope:
   ```json
   {
     "event_based": true,
     "include_target_info": true
   }
   ```
2. SAVE

---

**Готово к использованию!** 🎉

**Проверено**: ✅ Все поля заполнены  
**Статус**: ✅ Сценарий активен  
**Результат**: ✅ События с аннотациями отображаются
