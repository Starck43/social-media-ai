# –ò—Ç–æ–≥–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–î–∞—Ç–∞:** 2024-12-10

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã
```bash
# –£–¥–∞–ª–µ–Ω–æ:
- bot_scenario_form_old.html (–æ—Ä–∏–≥–∏–Ω–∞–ª - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
- bot_scenario_form_working.html (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è)
- bot_scenario_form_broken.html (—Å–ª–æ–º–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- bot_scenario_form_fixed.html (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –≤–µ—Ä—Å–∏—è)

# –û—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—á–∏–µ:
- bot_scenario_create.html (80 –±–∞–π—Ç)
- bot_scenario_edit.html (78 –±–∞–π—Ç)
- bot_scenario_form.html (18KB - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª)
```

### 2. –£–±—Ä–∞–Ω—ã –ª–æ–≥–∏ –æ—Ç–ª–∞–¥–∫–∏
```javascript
// –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ console.log:
- ‚úì Loading initial values...
- ‚úì Content types from obj: ...
- ‚úì Checked content type: ...
- ‚úì Checked analysis type: ...
- ‚úì Loaded scope into JSON editor
- ‚úì Synced - analysis_types: ...
```

**–§–æ—Ä–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∏—Ö–æ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏.**

### 3. –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### `docs/BOT_BEHAVIOR.md` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ:
- –°—Ç—Ä—É–∫—Ç—É—Ä–µ BotScenario
- –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ "–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
- –õ–æ–≥–∏–∫–µ —Ä–∞–±–æ—Ç—ã AI –±–æ—Ç–∞
- –ü–æ–≤–µ–¥–µ–Ω–∏–∏ action_type
- –°—Ö–µ–º–µ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

---

## üìã Section "–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"

**–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è (—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ SQLAdmin):**

1. **–ù–∞–∑–≤–∞–Ω–∏–µ** (`name`) - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
   - –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
   - –ü—Ä–∏–º–µ—Ä: "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤"

2. **–û–ø–∏—Å–∞–Ω–∏–µ** (`description`) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ
   - Textarea
   - –ü—Ä–∏–º–µ—Ä: "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–∑—ã–≤–æ–≤ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤"

3. **–ü—Ä–æ–º–ø—Ç –¥–ª—è –ò–ò** (`ai_prompt`) - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
   - –ë–æ–ª—å—à–∞—è textarea
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI –∫–∞–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
   - –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ scope: `{variable_name}`
   - –ü—Ä–∏–º–µ—Ä:
     ```
     –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —ç—Ç–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.
     –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ {topics}.
     –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º: {sentiment_config.categories}
     ```

4. **–ê–∫—Ç–∏–≤–µ–Ω** (`is_active`) - —á–µ–∫–±–æ–∫—Å
   - –í–∫–ª—é—á–µ–Ω/–≤—ã–∫–ª—é—á–µ–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π

5. **–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏** (`cooldown_minutes`) - —á–∏—Å–ª–æ
   - –ö–∞–∫ —á–∞—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–≤ –º–∏–Ω—É—Ç–∞—Ö)
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 30

**–≠—Ç–∏ –ø–æ–ª—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è SQLAdmin –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `render_form_fields()`**

---

## ü§ñ –õ–æ–≥–∏–∫–∞ action_type

### –ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç:
**–î–ê, –∞–Ω–∞–ª–∏–∑ –í–°–ï–ì–î–ê —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É ai_analytics –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç action_type.**

`action_type` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ** –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞.

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:

```
1. –°–±–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (posts, comments, etc.)
   ‚Üì
2. AI –∞–Ω–∞–ª–∏–∑ (sentiment, keywords, etc.)
   ‚Üì
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ai_analytics ‚Üê –í–°–ï–ì–î–ê –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   ‚Üì
4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç action_type):
   - None          ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å (—Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑)
   - NOTIFICATION  ‚Üí —Å–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
   - COMMENT       ‚Üí –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –±–æ—Ç–∞
   - MODERATION    ‚Üí —Å–∫—Ä—ã—Ç—å —Ç–æ–∫—Å–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
   - REPLY         ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - POST          ‚Üí —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç
   - REACTION      ‚Üí –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é
```

### –ü—Ä–∏–º–µ—Ä—ã:

#### action_type = None (–ø–∞—Å—Å–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
```python
# –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. ‚úÖ –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω
2. ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ ai_analytics
3. ‚ùå –ù–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
```

#### action_type = NOTIFICATION
```python
# –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. ‚úÖ –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω
2. ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ ai_analytics
3. ‚úÖ –°–æ–∑–¥–∞–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
```

#### action_type = MODERATION
```python
# –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. ‚úÖ –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω
2. ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ ai_analytics
3. ‚úÖ –¢–æ–∫—Å–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç
4. ‚úÖ –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä —É–≤–µ–¥–æ–º–ª—ë–Ω

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
```

---

## üí° –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ action –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**
- –ï—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω action_type - —Ç–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑
- –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω NOTIFICATION - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ **–ò** —Å–æ–∑–¥–∞—ë—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### 2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
```python
try:
    # –°–Ω–∞—á–∞–ª–∞ –í–°–ï–ì–î–ê —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∞–Ω–∞–ª–∏–∑
    analytics = AIAnalytics.objects.create(...)
except Exception as e:
    log_error(e)
    return  # –ï—Å–ª–∏ –∞–Ω–∞–ª–∏–∑ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è - –¥–∞–ª—å—à–µ –Ω–µ –∏–¥—ë–º

# –ü–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω—è–µ–º action (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
if scenario.action_type:
    try:
        execute_action(scenario.action_type, analytics)
    except Exception as e:
        log_error(e)
        # –ê–Ω–∞–ª–∏–∑ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω, action –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω
```

### 3. –ì–∏–±–∫–æ—Å—Ç—å
- –ú–æ–∂–Ω–æ –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- –û–¥–∏–Ω —Å action_type=None –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –î—Ä—É–≥–æ–π —Å action_type=NOTIFICATION –¥–ª—è –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
- –û–±–∞ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### BotScenario (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
```python
{
    "name": "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ–≥–∞—Ç–∏–≤–∞",
    "content_types": ["posts", "comments"],
    "analysis_types": ["sentiment", "toxicity"],
    "action_type": "NOTIFICATION",
    "is_active": true,
    "cooldown_minutes": 60
}
```

### AIAnalytics (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã - –í–°–ï–ì–î–ê —Å–æ–∑–¥–∞—é—Ç—Å—è)
```python
{
    "source_id": 1,
    "scenario_id": 1,
    "analysis_date": "2024-12-10",
    "analysis_data": {
        "sentiment": {"positive": 20, "negative": 5},
        "toxicity": {"score": 0.3}
    },
    "sentiment_summary": {...},
    "keywords": [...],
    "created_at": "2024-12-10 15:30:00"
}
```

### Notification (—Å–æ–∑–¥–∞—ë—Ç—Å—è –ï–°–õ–ò action_type=NOTIFICATION)
```python
{
    "user_id": 1,
    "type": "TREND_ALERT",
    "title": "–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ–≥–∞—Ç–∏–≤–∞",
    "message": "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 5 –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤",
    "data": {"analytics_id": 123},
    "is_read": false
}
```

---

## üéØ –ò—Ç–æ–≥–æ

### –§–∞–π–ª—ã:
- ‚úÖ –û—á–∏—â–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã (—É–¥–∞–ª–µ–Ω–æ 4 —Ñ–∞–π–ª–∞)
- ‚úÖ –£–±—Ä–∞–Ω—ã –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏
- ‚úÖ –§–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∏—Å—Ç–æ

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ `docs/BOT_BEHAVIOR.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞
- ‚úÖ `CLEANUP_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª (–∏—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞)

### –õ–æ–≥–∏–∫–∞:
- ‚úÖ "–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" = name, description, ai_prompt, is_active, cooldown_minutes
- ‚úÖ –ê–Ω–∞–ª–∏–∑ **–í–°–ï–ì–î–ê** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ ai_analytics
- ‚úÖ `action_type` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ** –¥–µ–π—Å—Ç–≤–∏–µ
- ‚úÖ `None` = —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑ (–ø–∞—Å—Å–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- ‚úÖ `NOTIFICATION` = –∞–Ω–∞–ª–∏–∑ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ)

---

**–í—Å—ë –≥–æ—Ç–æ–≤–æ –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ!** ‚úÖ
