# Custom Media Prompts - Implementation Complete ‚úÖ

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–µ–¥–∏–∞ –≤ BotScenario.

**–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è:**
- üìù –¢–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- üñºÔ∏è –ê–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- üé• –ê–Ω–∞–ª–∏–∑–∞ –≤–∏–¥–µ–æ
- üéµ –ê–Ω–∞–ª–∏–∑–∞ –∞—É–¥–∏–æ
- üìä –°–æ–∑–¥–∞–Ω–∏—è unified summary

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚úÖ

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `0032_add_media_prompts_to_scenarios.py`

**–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ `bot_scenarios`:**
```sql
-- Rename existing
ai_prompt ‚Üí text_prompt (TEXT, nullable)

-- New fields
image_prompt            TEXT NULL  -- Custom image analysis prompt
video_prompt            TEXT NULL  -- Custom video analysis prompt
audio_prompt            TEXT NULL  -- Custom audio analysis prompt
unified_summary_prompt  TEXT NULL  -- Custom unified summary prompt
```

–í—Å–µ –ø–æ–ª—è nullable ‚Üí –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å!

### 2. –ú–æ–¥–µ–ª—å BotScenario ‚úÖ

**–§–∞–π–ª:** `app/models/bot_scenario.py`

**–ù–æ–≤—ã–µ –ø–æ–ª—è:**
```python
class BotScenario(Base, TimestampMixin):
    # Media-specific prompts
    text_prompt: Mapped[str | None] = Column(Text, nullable=True)
    image_prompt: Mapped[str | None] = Column(Text, nullable=True)
    video_prompt: Mapped[str | None] = Column(Text, nullable=True)
    audio_prompt: Mapped[str | None] = Column(Text, nullable=True)
    unified_summary_prompt: Mapped[str | None] = Column(Text, nullable=True)
    
    # Backward compatibility
    @property
    def ai_prompt(self) -> str | None:
        return self.text_prompt
    
    @ai_prompt.setter
    def ai_prompt(self, value: str | None):
        self.text_prompt = value
```

### 3. Prompt Variables System ‚úÖ

**–§–∞–π–ª:** `app/services/ai/prompt_variables.py`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üìã –†–µ–µ—Å—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –º–µ–¥–∏–∞
- üîÑ –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —à–∞–±–ª–æ–Ω—ã
- üå≤ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (`{stats.total_posts}`)
- üìñ Help text –¥–ª—è –∞–¥–º–∏–Ω–∫–∏

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

**–î–ª—è —Ç–µ–∫—Å—Ç–∞:**
```
{text} - –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
{platform} - –ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (VK, Telegram)
{source_type} - –¢–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (user, group, channel)
{total_posts} - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤
{total_reactions} - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–∫—Ü–∏–π
{total_comments} - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
{avg_reactions} - –°—Ä–µ–¥–Ω–µ–µ —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ –ø–æ—Å—Ç
{avg_comments} - –°—Ä–µ–¥–Ω–µ–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–∞ –ø–æ—Å—Ç
{date_range_first} - –ü–µ—Ä–≤–∞—è –¥–∞—Ç–∞ –≤ –≤—ã–±–æ—Ä–∫–µ
{date_range_last} - –ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞ –≤ –≤—ã–±–æ—Ä–∫–µ
{stats} - –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```

**–î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
```
{count} - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
{platform} - –ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
```

**–î–ª—è –≤–∏–¥–µ–æ:**
```
{count} - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
{platform} - –ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
```

**–î–ª—è –∞—É–¥–∏–æ:**
```
{count} - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
{platform} - –ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
```

### 4. PromptBuilder ‚úÖ

**–§–∞–π–ª:** `app/services/ai/prompts.py`

**–ù–æ–≤—ã–π API:**

```python
# –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
prompt = PromptBuilder.get_prompt(
    media_type=MediaType.TEXT,
    scenario=bot_scenario,  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    # –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
    text="...",
    platform_name="VK",
    stats={...},
    count=5
)

# –î–ª—è unified summary
prompt = PromptBuilder.get_unified_summary_prompt(
    text_analysis={...},
    image_analysis={...},
    video_analysis={...},
    scenario=bot_scenario  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
)
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏
2. –ï—Å–ª–∏ –¥–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π hardcoded –ø—Ä–æ–º–ø—Ç

### 5. AIAnalyzer Integration ‚úÖ

**–§–∞–π–ª:** `app/services/ai/analyzer.py`

**–û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:**
- `_analyze_text()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `PromptBuilder.get_prompt(MediaType.TEXT, ...)`
- `_analyze_images()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `PromptBuilder.get_prompt(MediaType.IMAGE, ...)`
- `_analyze_videos()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `PromptBuilder.get_prompt(MediaType.VIDEO, ...)`
- `_create_unified_summary()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `PromptBuilder.get_unified_summary_prompt(...)`

**–£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞:**
- ‚ùå –£–±—Ä–∞–Ω ScenarioPromptBuilder (deprecated)
- ‚ùå –£–±—Ä–∞–Ω—ã if/else –≤–µ—Ç–≤–ª–µ–Ω–∏—è –¥–ª—è ai_prompt
- ‚úÖ –ï–¥–∏–Ω—ã–π –ø—É—Ç—å —á–µ—Ä–µ–∑ `PromptBuilder.get_prompt()`

### 6. Admin Panel ‚úÖ

**–§–∞–π–ª:** `app/admin/views.py`

**BotScenarioAdmin –æ–±–Ω–æ–≤–ª–µ–Ω:**

**–ù–æ–≤—ã–µ labels:**
```python
"text_prompt": "–ü—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞",
"image_prompt": "–ü—Ä–æ–º–ø—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π",
"video_prompt": "–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–∏–¥–µ–æ",
"audio_prompt": "–ü—Ä–æ–º–ø—Ç –¥–ª—è –∞—É–¥–∏–æ",
"unified_summary_prompt": "–ü—Ä–æ–º–ø—Ç –¥–ª—è –æ–±—â–µ–≥–æ —Ä–µ–∑—é–º–µ",
```

**Form widgets:**
```python
"text_prompt": {"rows": 10},
"image_prompt": {"rows": 10},
"video_prompt": {"rows": 10},
"audio_prompt": {"rows": 10},
"unified_summary_prompt": {"rows": 10},
```

**Help texts:**
```python
'text_prompt': {
    'description': '–ö–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–∞. –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {text}, {platform}, {source_type}, {total_posts}, {avg_reactions}, {avg_comments}'
},
'image_prompt': {
    'description': '–ö–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {count}, {platform}'
},
# –ò —Ç.–¥.
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ –≤ e-commerce

```python
# –í –∞–¥–º–∏–Ω–∫–µ —Å–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π:
name = "–ê–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤"

text_prompt = """
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—Ç–∑—ã–≤—ã –æ —Ç–æ–≤–∞—Ä–µ –∏–∑ {platform}.
–í—Å–µ–≥–æ –æ—Ç–∑—ã–≤–æ–≤: {total_posts}

–ö–æ–Ω—Ç–µ–Ω—Ç:
{text}

–í—ã–¥–µ–ª–∏:
1. –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞
2. –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π
3. –°—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏
4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON
"""

image_prompt = """
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π {count} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ç–æ–≤–∞—Ä–∞ —Å {platform}.

–û–ø—Ä–µ–¥–µ–ª–∏:
1. –ö–∞—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ/–ª—é–±–∏—Ç–µ–ª—å—Å–∫–∏–µ)
2. –ü–æ–∫–∞–∑–∞–Ω—ã –ª–∏ –¥–µ—Ñ–µ–∫—Ç—ã –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
3. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–ø–∏—Å–∞–Ω–∏—é
4. –ö–∞—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–∫–∏
5. –ù–∞–ª–∏—á–∏–µ –±—Ä–µ–Ω–¥–∏–Ω–≥–∞

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON
"""

video_prompt = """
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π {count} –≤–∏–¥–µ–æ —Å —Ä–∞—Å–ø–∞–∫–æ–≤–∫–æ–π/–æ–±–∑–æ—Ä–æ–º —Ç–æ–≤–∞—Ä–∞.

–ü—Ä–æ–≤–µ—Ä—å:
1. –ü–æ–∫–∞–∑–∞–Ω –ª–∏ —Ç–æ–≤–∞—Ä –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
2. –†–µ–∞–∫—Ü–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è/–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è)
3. –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏
4. –°—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –∞–Ω–∞–ª–æ–≥–∞–º–∏

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON
"""
```

### –ü—Ä–∏–º–µ—Ä 2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±—Ä–µ–Ω–¥–∞

```python
name = "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±—Ä–µ–Ω–¥–∞"

text_prompt = """
–ê–Ω–∞–ª–∏–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –±—Ä–µ–Ω–¥–∞ –≤ {platform}.
–ü–µ—Ä–∏–æ–¥: {date_range_first} - {date_range_last}
–í—Å–µ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π: {total_posts}

{text}

–ó–∞–¥–∞—á–∏:
1. –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–π (–ø–æ–∑–∏—Ç–∏–≤/–Ω–µ–≥–∞—Ç–∏–≤/–Ω–µ–π—Ç—Ä–∞–ª)
2. –ö–æ–Ω—Ç–µ–∫—Å—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è (—Ä–µ–∫–ª–∞–º–∞/–æ—Ç–∑—ã–≤/–Ω–æ–≤–æ—Å—Ç—å)
3. –°—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏
4. –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Ñ–ª—é–µ–Ω—Å–µ—Ä—ã

JSON –æ—Ç–≤–µ—Ç
"""

image_prompt = """
{count} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –±—Ä–µ–Ω–¥–∞ ({platform}).

–ù–∞–π–¥–∏:
1. –õ–æ–≥–æ—Ç–∏–ø –±—Ä–µ–Ω–¥–∞ (–¥–∞/–Ω–µ—Ç)
2. –ü—Ä–æ–¥—É–∫—Ç—ã –±—Ä–µ–Ω–¥–∞
3. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
4. UGC vs –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

JSON
"""
```

### –ü—Ä–∏–º–µ—Ä 3: Crisis Management

```python
name = "–ö—Ä–∏–∑–∏—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"

text_prompt = """
‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –ù–ï–ì–ê–¢–ò–í–ê

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: {platform}
–ü–æ—Å—Ç–æ–≤: {total_posts}
–°—Ä–µ–¥–Ω—è—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å: {avg_reactions} —Ä–µ–∞–∫—Ü–∏–π, {avg_comments} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

–ö–æ–Ω—Ç–µ–Ω—Ç:
{text}

–°–†–û–ß–ù–û –æ–ø—Ä–µ–¥–µ–ª–∏:
1. –£—Ä–æ–≤–µ–Ω—å —É–≥—Ä–æ–∑—ã —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ (–í–´–°–û–ö–ò–ô/–°–†–ï–î–ù–ò–ô/–ù–ò–ó–ö–ò–ô)
2. –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ (—Ç–æ–ø-3)
3. –õ–∏–¥–µ—Ä—ã –º–Ω–µ–Ω–∏–π —Å—Ä–µ–¥–∏ –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã—Ö
4. –°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è (–≤–∏—Ä—É—Å–Ω–æ—Å—Ç—å)
5. –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—é

–§–æ—Ä–º–∞—Ç: JSON —Å –ø–æ–ª–µ–º "urgency_score" (0-100)
"""
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit Tests ‚úÖ

```bash
cd /Users/admin/Projects/social-media-ai

# Test 1: Model fields
python3 -c "
from app.models import BotScenario
s = BotScenario()
assert hasattr(s, 'text_prompt')
assert hasattr(s, 'image_prompt')
assert hasattr(s, 'video_prompt')
print('‚úÖ Model fields OK')
"

# Test 2: Variable substitution
python3 -c "
from app.services.ai.prompt_variables import PromptSubstitution
result = PromptSubstitution.substitute('{platform}: {count}', {'platform': 'VK', 'count': 5})
assert result == 'VK: 5'
print('‚úÖ Variable substitution OK')
"

# Test 3: Custom prompt integration
python3 -c "
from app.types import MediaType
from app.services.ai.prompts import PromptBuilder

class MockScenario:
    text_prompt = 'Custom: {text}'
    image_prompt = None
    video_prompt = None
    audio_prompt = None
    unified_summary_prompt = None

prompt = PromptBuilder.get_prompt(MediaType.TEXT, MockScenario(), text='test')
assert 'Custom: test' == prompt
print('‚úÖ Custom prompts OK')
"
```

**–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã! ‚úÖ**

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

–°—Ç–∞—Ä–æ–µ –ø–æ–ª–µ `ai_prompt` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤ `text_prompt`:

```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
ALTER TABLE social_manager.bot_scenarios
  RENAME COLUMN ai_prompt TO text_prompt;
```

### Backward Compatibility

–°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è property:

```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ (–≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):
scenario.ai_prompt = "My prompt"

# –ù–æ–≤—ã–π –∫–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
scenario.text_prompt = "My prompt"
scenario.image_prompt = "Image analysis prompt"
scenario.video_prompt = "Video analysis prompt"
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
app/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ bot_scenario.py               # ‚ú® Updated: +5 prompt fields, +property
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ ai/
‚îÇ       ‚îú‚îÄ‚îÄ analyzer.py                # ‚ú® Updated: uses PromptBuilder.get_prompt()
‚îÇ       ‚îú‚îÄ‚îÄ prompts.py                 # ‚ú® Updated: +get_prompt(), +get_unified_summary_prompt()
‚îÇ       ‚îî‚îÄ‚îÄ prompt_variables.py        # ‚ú® NEW: Variable system
‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îî‚îÄ‚îÄ views.py                       # ‚ú® Updated: BotScenarioAdmin with prompt fields
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ enum_helpers.py                # (unchanged)

migrations/
‚îî‚îÄ‚îÄ versions/
    ‚îî‚îÄ‚îÄ 0032_add_media_prompts_to_scenarios.py  # ‚ú® NEW

docs/
‚îú‚îÄ‚îÄ CUSTOM_MEDIA_PROMPTS_PROPOSAL.md           # Planning doc
‚îî‚îÄ‚îÄ CUSTOM_MEDIA_PROMPTS_IMPLEMENTATION.md     # ‚ú® NEW: This file
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π = —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã  
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –≤ –∞–¥–º–∏–Ω–∫–µ  
‚úÖ **–ú–æ—â–Ω–æ—Å—Ç—å** - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö  
‚úÖ **Fallback** - –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ  
‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ  

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
‚úÖ **Type-safe** - —è–≤–Ω—ã–µ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª–∏  
‚úÖ **Testable** - –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å mock scenarios  
‚úÖ **Extensible** - –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –º–µ–¥–∏–∞  
‚úÖ **Clean Code** - –µ–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ —á–µ—Ä–µ–∑ `PromptBuilder.get_prompt()`  
‚úÖ **DRY** - –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤  

## Roadmap

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

**Phase 2: Template Engine (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Jinja2 –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
- –£—Å–ª–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö
- –¶–∏–∫–ª—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ø–∏—Å–∫–æ–≤

**Phase 3: Prompt Library (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≥–æ—Ç–æ–≤—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- Sharing –ø—Ä–æ–º–ø—Ç–æ–≤ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

**Phase 4: A/B Testing (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –º–µ–¥–∏–∞:

- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (+5 –ø–æ–ª–µ–π)
- ‚úÖ –ú–æ–¥–µ–ª—å BotScenario (+properties, +backward compatibility)
- ‚úÖ Variable substitution system
- ‚úÖ PromptBuilder unified API
- ‚úÖ AIAnalyzer integration
- ‚úÖ Admin panel UI
- ‚úÖ Unit tests
- ‚úÖ Documentation

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production!** üöÄ

**–¢–µ–ø–µ—Ä—å –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å AI-–∞–Ω–∞–ª–∏–∑–∞.**
