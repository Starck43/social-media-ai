# –ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ VS —á—Ç–æ —Ä—É–∫–∞–º–∏ –≤ –ø—Ä–æ–º–ø—Ç–µ

**–í–æ–ø—Ä–æ—Å**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –≤ –ø—Ä–æ–º–ø—Ç–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –Ω—É–∂–Ω–æ —Ä—É–∫–∞–º–∏ —É–∫–∞–∑—ã–≤–∞—Ç—å?

**–û—Ç–≤–µ—Ç**: **–ß–ê–°–¢–ò–ß–ù–û –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò** - —Å–∏—Å—Ç–µ–º–∞ —É–º–Ω–∞—è –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–µ!

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å

### **1. –í–∞—à Text Prompt** (—Ä—É–∫–∞–º–∏)

–í—ã –ø–∏—à–µ—Ç–µ –≤ –∞–¥–º–∏–Ω–∫–µ:

```
–¢—ã - –∞–Ω–∞–ª–∏—Ç–∏–∫ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ó–ê–î–ê–ß–ê:
–î–ª—è –ö–ê–ñ–î–û–ì–û —Å–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞–π –ö–†–ê–¢–ö–ò–ô –ê–ù–û–ù–°.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê - —Å—Ç—Ä–æ–≥–∏–π JSON:
{
  "analysis_title": "...",
  "events": [...]
}
```

### **2. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç**

#### ‚úÖ **COMMON_FIELDS** (–≤—Å–µ–≥–¥–∞)

–ï—Å–ª–∏ –≤ –≤–∞—à–µ–º –ø—Ä–æ–º–ø—Ç–µ –ù–ï–¢ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —ç—Ç–∏—Ö –ø–æ–ª–µ–π, —Å–∏—Å—Ç–µ–º–∞ **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –î–û–ë–ê–í–ò–¢**:

```python
# app/services/ai/json_schema_builder.py
COMMON_FIELDS = {
    'analysis_title': '–∫—Ä–∞—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∞–Ω–∞–ª–∏–∑–∞ (3-7 —Å–ª–æ–≤)',
    'analysis_summary': '—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)',
}
```

#### ‚úÖ **Analysis Types** (–∏–∑ —Ñ–æ—Ä–º—ã)

–ï—Å–ª–∏ –≤—ã –≤—ã–±—Ä–∞–ª–∏ –≤ —Ñ–æ—Ä–º–µ `Analysis Types: ["sentiment", "keywords", "topics"]`, —Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–∏—Ç:

```json
{
  "sentiment_score": "—á–∏—Å–ª–æ –æ—Ç 0.0 –¥–æ 1.0",
  "sentiment_label": "–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π|–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π|–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π|–°–º–µ—à–∞–Ω–Ω—ã–π",
  "keywords": ["–∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ 1", "..."],
  "main_topics": ["—Ç–µ–º–∞ 1", "—Ç–µ–º–∞ 2"]
}
```

#### ‚úÖ **Scope –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** (–∏–∑ JSON –ø–æ–ª—è Scope)

–ï—Å–ª–∏ –≤ Scope —É–∫–∞–∑–∞–Ω–æ:

```json
{
  "sentiment": {
    "categories": ["–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π", "–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π", "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–º–µ—à–∞–Ω–Ω—ã–π"]
  },
  "keywords": {
    "max_keywords": 10
  }
}
```

–¢–æ —Å–∏—Å—Ç–µ–º–∞ **–ø–æ–¥—Å—Ç–∞–≤–∏—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è** –≤ schema:

```json
{
  "sentiment_label": "–æ–¥–Ω–æ –∏–∑: '–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π', '–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π', '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π', '–°–º–µ—à–∞–Ω–Ω—ã–π'",
  "keywords": "—Å–ø–∏—Å–æ–∫ –∏–∑ 10 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤"
}
```

### **3. –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç** (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ LLM)

–°–∏—Å—Ç–µ–º–∞ **–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç**:

1. **–í–∞—à Text Prompt**
2. **COMMON_FIELDS** (–µ—Å–ª–∏ –Ω–µ—Ç –≤ –ø—Ä–æ–º–ø—Ç–µ)
3. **Analysis Types schema** (–Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±–æ—Ä–∞ –≤ —Ñ–æ—Ä–º–µ)
4. **Scope –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (–∏–∑ JSON –ø–æ–ª—è Scope)
5. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** (–ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç `{text}`, `{platform}`, –∏ —Ç.–¥.)

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä—É–∫–∞–º–∏, —á—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è**

| –ß—Ç–æ | –û—Ç–∫—É–¥–∞ | –ü—Ä–∏–º–µ—Ä |
|-----|--------|--------|
| **analysis_title** | COMMON_FIELDS | –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è |
| **analysis_summary** | COMMON_FIELDS | –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è |
| **sentiment_score** | Analysis Types | –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω "sentiment" |
| **sentiment_label** | Analysis Types + Scope | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ Scope |
| **keywords** | Analysis Types | –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω "keywords" |
| **main_topics** | Analysis Types | –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω "topics" |
| **–ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ {text}** | –°–∏—Å—Ç–µ–º–∞ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **–ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ {platform}** | –°–∏—Å—Ç–µ–º–∞ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **–ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ {date_range}** | –°–∏—Å—Ç–µ–º–∞ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |

### üñäÔ∏è **–ù—É–∂–Ω–æ —Ä—É–∫–∞–º–∏ —É–∫–∞–∑—ã–≤–∞—Ç—å**

| –ß—Ç–æ | –ì–¥–µ | –ü—Ä–∏–º–µ—Ä |
|-----|-----|--------|
| **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è** | Text Prompt | `"events": [...]` |
| **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ events** | Text Prompt | `{"type": "post", "annotation": "..."}` |
| **–ü—Ä–∏–º–µ—Ä—ã –∞–Ω–æ–Ω—Å–æ–≤** | Text Prompt | `‚úÖ "–•–æ—Ä–æ—à–∏–π –∞–Ω–æ–Ω—Å..."` |
| **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** | Text Prompt | `"–î–ª—è –ö–ê–ñ–î–û–ì–û —Å–æ–±—ã—Ç–∏—è..."` |
| **event_based —Ñ–ª–∞–≥** | Scope | `{"event_based": true}` |
| **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** | Scope | `{"sentiment": {"categories": [...]}}` |

---

## üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ –¥–ª—è Scenario #10

### **–ß—Ç–æ –≤—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ —Ä—É–∫–∞–º–∏ –≤ Text Prompt**:

```
–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê - —Å—Ç—Ä–æ–≥–∏–π JSON:
{
  "analysis_title": "...",
  "analysis_summary": "...",
  "events": [                    // ‚¨ÖÔ∏è –†–£–ö–ê–ú–ò!
    {
      "type": "post|comment|like",     // ‚¨ÖÔ∏è –†–£–ö–ê–ú–ò!
      "time": "...",                    // ‚¨ÖÔ∏è –†–£–ö–ê–ú–ò!
      "annotation": "...",              // ‚¨ÖÔ∏è –†–£–ö–ê–ú–ò!
      "sentiment": 0.0-1.0,            // ‚¨ÖÔ∏è –†–£–ö–ê–ú–ò (–∏–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–∏—Ç)
      "keywords": [...]                 // ‚¨ÖÔ∏è –†–£–ö–ê–ú–ò (–∏–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–∏—Ç)
    }
  ],
  "statistics": {               // ‚¨ÖÔ∏è –†–£–ö–ê–ú–ò!
    "total_posts": 0,
    "total_comments": 0
  }
}
```

**–ü–æ—á–µ–º—É —Ä—É–∫–∞–º–∏?** –ü–æ—Ç–æ–º—É —á—Ç–æ `events` –∏ `statistics` - —ç—Ç–æ **–ö–ê–°–¢–û–ú–ù–´–ï** –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö COMMON_FIELDS.

### **–ß—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**:

–ï—Å–ª–∏ –≤ –≤–∞—à–µ–º –ø—Ä–æ–º–ø—Ç–µ –Ω–µ—Ç —ç—Ç–∏—Ö –ø–æ–ª–µ–π, —Å–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–∏—Ç:

```json
{
  "analysis_title": "–∫—Ä–∞—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (3-7 —Å–ª–æ–≤)",     // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò
  "analysis_summary": "–æ–ø–∏—Å–∞–Ω–∏–µ (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)",     // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò
  "sentiment_score": "—á–∏—Å–ª–æ –æ—Ç 0.0 –¥–æ 1.0",            // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò (–µ—Å–ª–∏ analysis_types = ["sentiment"])
  "sentiment_label": "–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π|–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π|...",     // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò
  "keywords": ["–∫–ª—é—á 1", "–∫–ª—é—á 2"],                    // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò (–µ—Å–ª–∏ analysis_types = ["keywords"])
  "main_topics": ["—Ç–µ–º–∞ 1", "—Ç–µ–º–∞ 2"]                  // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò (–µ—Å–ª–∏ analysis_types = ["topics"])
}
```

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–∏—Ç

### **–ü—Ä–∏–º–µ—Ä 1: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç**

**–í–∞—à Text Prompt** (—Ä—É–∫–∞–º–∏):

```
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
```

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ LLM** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):

```
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–í–ê–ñ–ù–û: –í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –°–¢–†–û–ì–û –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:
{
  "analysis_title": "–∫—Ä–∞—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∞–Ω–∞–ª–∏–∑–∞ (3-7 —Å–ª–æ–≤)",
  "analysis_summary": "—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)",
  "sentiment_score": "—á–∏—Å–ª–æ –æ—Ç 0.0 (–Ω–µ–≥–∞—Ç–∏–≤) –¥–æ 1.0 (–ø–æ–∑–∏—Ç–∏–≤)",
  "sentiment_label": "–æ–¥–Ω–æ –∏–∑: '–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π', '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π', '–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π', '–°–º–µ—à–∞–Ω–Ω—ã–π'",
  "keywords": "—Å–ø–∏—Å–æ–∫ –∏–∑ 15 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤",
  "main_topics": "—Å–ø–∏—Å–æ–∫ –∏–∑ 5 –≥–ª–∞–≤–Ω—ã—Ö —Ç–µ–º"
}
```

**–û—Ç–∫—É–¥–∞**:
- `analysis_title`, `analysis_summary` ‚Üí COMMON_FIELDS
- `sentiment_*` ‚Üí Analysis Types = ["sentiment"] + Scope
- `keywords` ‚Üí Analysis Types = ["keywords"] + Scope
- `main_topics` ‚Üí Analysis Types = ["topics"] + Scope

### **–ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–æ–ª—è–º–∏**

**–í–∞—à Text Prompt** (—Ä—É–∫–∞–º–∏):

```
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê - —Å—Ç—Ä–æ–≥–∏–π JSON:
{
  "analysis_title": "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –¥–∞—Ç—É",
  "events": [
    {
      "type": "post",
      "annotation": "–∫—Ä–∞—Ç–∫–∏–π –∞–Ω–æ–Ω—Å"
    }
  ]
}
```

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ LLM** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):

```
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê - —Å—Ç—Ä–æ–≥–∏–π JSON:
{
  "analysis_title": "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –¥–∞—Ç—É",
  "events": [
    {
      "type": "post",
      "annotation": "–∫—Ä–∞—Ç–∫–∏–π –∞–Ω–æ–Ω—Å"
    }
  ]
}
```

**–°–∏—Å—Ç–µ–º–∞ –ù–ï –î–û–ë–ê–í–ò–¢** COMMON_FIELDS, –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –ü—Ä–æ–º–ø—Ç **–£–ñ–ï –°–û–î–ï–†–ñ–ò–¢** JSON —Ñ–æ—Ä–º–∞—Ç
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º: `"—Ñ–æ—Ä–º–∞—Ç"`, `"json"`

**–ù–û**: –ï—Å–ª–∏ –≤ Scope —É–∫–∞–∑–∞–Ω–æ `"event_based": true`, —Ç–æ analyzer –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏!

---

## ‚öôÔ∏è Scope - —á—Ç–æ —ç—Ç–æ –∏ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### **Scope** - —ç—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

**–í —Ñ–æ—Ä–º–µ** (JSON –ø–æ–ª–µ):

```json
{
  "event_based": true,              // ‚¨ÖÔ∏è –§–ª–∞–≥: —Ä–µ–∂–∏–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–æ–±—ã—Ç–∏—è–º
  "max_events_per_analysis": 50,    // ‚¨ÖÔ∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
  "include_target_info": true,       // ‚¨ÖÔ∏è –í–∫–ª—é—á–∞—Ç—å –∏–Ω—Ñ—É –æ target
  "annotation_length": "brief",      // ‚¨ÖÔ∏è –î–ª–∏–Ω–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
  
  "sentiment": {                     // ‚¨ÖÔ∏è –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è sentiment –∞–Ω–∞–ª–∏–∑–∞
    "categories": ["–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π", "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π", "–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π", "–°–º–µ—à–∞–Ω–Ω—ã–π"]
  },
  "keywords": {                      // ‚¨ÖÔ∏è –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è keywords –∞–Ω–∞–ª–∏–∑–∞
    "max_keywords": 10
  },
  "topics": {                        // ‚¨ÖÔ∏è –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è topics –∞–Ω–∞–ª–∏–∑–∞
    "max_topics": 5
  }
}
```

### **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Scope**:

#### 1. **–í analyzer.py**

```python
# app/services/ai/analyzer.py
async def analyze_content(self, content, source, bot_scenario):
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–ª–∞–≥ event_based
    is_event_based = False
    if bot_scenario and bot_scenario.scope:
        is_event_based = bot_scenario.scope.get('event_based', False)
    
    if is_event_based:
        # –†–µ–∂–∏–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–æ–±—ã—Ç–∏—è–º
        return await self._analyze_events(content, source, bot_scenario)
    else:
        # –†–µ–∂–∏–º –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (–æ–±—ã—á–Ω—ã–π)
        return await self._analyze_aggregated(content, source, bot_scenario)
```

#### 2. **–í JSON schema builder**

```python
# app/services/ai/json_schema_builder.py
def build_schema(cls, analysis_types, scope):
    schema = {}
    
    # –î–æ–±–∞–≤–∏—Ç—å COMMON_FIELDS
    schema.update(cls.COMMON_FIELDS)
    
    # –î–ª—è –∫–∞–∂–¥–æ–≥–æ analysis_type
    for analysis_type in analysis_types:
        # –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ –∏–∑ scope
        type_config = scope.get(analysis_type, {})  # ‚¨ÖÔ∏è –ë–µ—Ä—ë—Ç –∏–∑ Scope!
        
        # –ü—Ä–∏–º–µ—Ä: –¥–ª—è keywords
        max_keywords = type_config.get('max_keywords', 15)  # ‚¨ÖÔ∏è –ò–∑ Scope!
        schema['keywords'] = f"—Å–ø–∏—Å–æ–∫ –∏–∑ {max_keywords} –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤"
```

#### 3. **–í –ø—Ä–æ–º–ø—Ç–µ** (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)

–ï—Å–ª–∏ –≤ Text Prompt –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:

```
–ú–∞–∫—Å–∏–º—É–º –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: {max_keywords}
```

–¢–æ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `scope.keywords.max_keywords`:

```
–ú–∞–∫—Å–∏–º—É–º –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: 10
```

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è Scenario #10

### **–í —Ñ–æ—Ä–º–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ**:

#### **Content Types** (checkboxes/JSON):
```json
["posts", "comments", "reactions"]
```
‚Üí –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–ß–¢–û —Å–æ–±–∏—Ä–∞—Ç—å** (VKClient)

#### **Analysis Types** (checkboxes/JSON):
```json
["sentiment", "keywords", "topics"]
```
‚Üí –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–ö–ê–ö–ò–ï –ø–æ–ª—è –¥–æ–±–∞–≤–∏—Ç—å** –≤ JSON schema (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

#### **Scope** (JSON):
```json
{
  "event_based": true,
  "max_events_per_analysis": 50,
  "include_target_info": true,
  
  "sentiment": {
    "categories": ["–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π", "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π", "–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π", "–°–º–µ—à–∞–Ω–Ω—ã–π"]
  },
  "keywords": {
    "max_keywords": 10
  }
}
```
‚Üí –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç:
1. **–†–µ–∂–∏–º –∞–Ω–∞–ª–∏–∑–∞** (`event_based: true`)
2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ analysis_type
3. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞

#### **Text Prompt** (—Ç–µ–∫—Å—Ç):
```
–¢—ã - –∞–Ω–∞–ª–∏—Ç–∏–∫. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê - —Å—Ç—Ä–æ–≥–∏–π JSON:
{
  "analysis_title": "...",
  "events": [...]  // ‚¨ÖÔ∏è –ö–ê–°–¢–û–ú–ù–û–ï –ü–û–õ–ï (—Ä—É–∫–∞–º–∏!)
}
```
‚Üí –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç:
1. **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** –¥–ª—è LLM
2. **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è** (events, statistics)
3. **–ü—Ä–∏–º–µ—Ä—ã** –∞–Ω–æ–Ω—Å–æ–≤
4. **–§–æ—Ä–º–∞—Ç** –æ—Ç–≤–µ—Ç–∞

### **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**:

1. **–ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**:
   - `{text}` ‚Üí –°–æ–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
   - `{platform}` ‚Üí "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ"
   - `{date_range}` ‚Üí "2025-10-15 - 2025-10-18"

2. **–î–æ–±–∞–≤–ª—è–µ—Ç COMMON_FIELDS** (–µ—Å–ª–∏ –Ω–µ—Ç –≤ –ø—Ä–æ–º–ø—Ç–µ):
   - `analysis_title`
   - `analysis_summary`

3. **–î–æ–±–∞–≤–ª—è–µ—Ç Analysis Types schema**:
   - `sentiment_score`, `sentiment_label` (–∏–∑ "sentiment")
   - `keywords` (–∏–∑ "keywords")
   - `main_topics` (–∏–∑ "topics")

4. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç Scope –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**:
   - `sentiment.categories` ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è sentiment_label
   - `keywords.max_keywords` ‚Üí –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ keywords
   - `event_based` ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –∞–Ω–∞–ª–∏–∑–∞

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è Scenario #10

### **–ù–ï –ü–û–õ–ê–ì–ê–ô–¢–ï–°–¨** –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∫—É

**–ü–æ—á–µ–º—É?** –ü–æ—Ç–æ–º—É —á—Ç–æ –¥–ª—è event-based –∞–Ω–∞–ª–∏–∑–∞ –Ω—É–∂–Ω–∞ **—Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** JSON —Å –ø–æ–ª—è–º–∏ `events[]` –∏ `statistics`, –∫–æ—Ç–æ—Ä—ã—Ö –ù–ï–¢ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö COMMON_FIELDS.

### **–£–ö–ê–ñ–ò–¢–ï –†–£–ö–ê–ú–ò** –≤ Text Prompt:

```
–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê - —Å—Ç—Ä–æ–≥–∏–π JSON:
{
  "analysis_title": "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ <–¥–∞—Ç–∞>",
  "analysis_summary": "–û–±—â–µ–µ —Ä–µ–∑—é–º–µ...",
  "events": [                    // ‚¨ÖÔ∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –†–£–ö–ê–ú–ò!
    {
      "type": "post|comment|like",
      "time": "ISO datetime",
      "event_id": "ID —Å–æ–±—ã—Ç–∏—è",
      "target": {...},
      "annotation": "...",
      "sentiment": 0.0-1.0,
      "keywords": [...]
    }
  ],
  "statistics": {...}             // ‚¨ÖÔ∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –†–£–ö–ê–ú–ò!
}
```

**–ü–æ—á–µ–º—É —Ç–∞–∫?** –ü–æ—Ç–æ–º—É —á—Ç–æ:
1. –°–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–µ—Ç –ø—Ä–æ `sentiment`, `keywords`, `topics` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ)
2. –°–∏—Å—Ç–µ–º–∞ **–ù–ï –ó–ù–ê–ï–¢** –ø—Ä–æ `events` –∏ `statistics` (–∫–∞—Å—Ç–æ–º–Ω—ã–µ)
3. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å —Ä—É–∫–∞–º–∏ ‚Üí LLM –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è

### **–°–ø–æ—Å–æ–± 1: –õ–æ–≥–∏**

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å DEBUG —É—Ä–æ–≤–Ω–µ–º:

```bash
export LOG_LEVEL=DEBUG
python cli/scheduler.py run --source-id 16
```

–ò—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:
```
Final prompt sent to LLM:
[... –≤–µ—Å—å –ø—Ä–æ–º–ø—Ç ...]
```

### **–°–ø–æ—Å–æ–± 2: –ö–æ–¥**

–î–æ–±–∞–≤–∏—Ç—å `logger.debug()` –≤ `prompts.py`:

```python
# app/services/ai/prompts.py
@staticmethod
def get_prompt(media_type, scenario, **context):
    # ... existing code ...
    
    # –ü–æ—Å–ª–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞
    logger.debug(f"Final prompt for {media_type}: {prompt}")
    
    return prompt
```

---

## üìä –¢–∞–±–ª–∏—Ü–∞: –ß—Ç–æ –æ—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è

| –ü–æ–ª–µ –≤ JSON | –û—Ç–∫—É–¥–∞ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏? |
|-------------|--------|----------------|
| **analysis_title** | COMMON_FIELDS –∏–ª–∏ Text Prompt | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–µ—Å–ª–∏ –Ω–µ—Ç –≤ –ø—Ä–æ–º–ø—Ç–µ) |
| **analysis_summary** | COMMON_FIELDS –∏–ª–∏ Text Prompt | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–µ—Å–ª–∏ –Ω–µ—Ç –≤ –ø—Ä–æ–º–ø—Ç–µ) |
| **sentiment_score** | Analysis Types = ["sentiment"] | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **sentiment_label** | Analysis Types + Scope | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **keywords** | Analysis Types = ["keywords"] + Scope | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **main_topics** | Analysis Types = ["topics"] + Scope | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **events** | Text Prompt (–∫–∞—Å—Ç–æ–º–Ω–æ–µ) | ‚ùå –†—É–∫–∞–º–∏! |
| **statistics** | Text Prompt (–∫–∞—Å—Ç–æ–º–Ω–æ–µ) | ‚ùå –†—É–∫–∞–º–∏! |
| **{text}** | –°–∏—Å—Ç–µ–º–∞ (–ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç) | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **{platform}** | –°–∏—Å—Ç–µ–º–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã) | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **{date_range}** | –°–∏—Å—Ç–µ–º–∞ (–ø–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞) | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **event_based —Ä–µ–∂–∏–º** | Scope.event_based | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–≤ analyzer.py) |

---

## üéì –í—ã–≤–æ–¥—ã

### 1. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ analysis types (`sentiment`, `keywords`, `topics`), —Ç–æ —Å–∏—Å—Ç–µ–º–∞ **—Å–∞–º–∞ –¥–æ–±–∞–≤–∏—Ç** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –≤ JSON schema.

### 2. **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è** ‚Üí –†—É–∫–∞–º–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `events[]` –¥–ª—è event-based –∞–Ω–∞–ª–∏–∑–∞), —Ç–æ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** —É–∫–∞–∑—ã–≤–∞—Ç—å –∏—Ö –≤ Text Prompt.

### 3. **Scope** ‚Üí –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

`Scope` –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è –≤ JSON, –∞ **–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç** –∏—Ö:
- `event_based: true` ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –∞–Ω–∞–ª–∏–∑–∞
- `sentiment.categories` ‚Üí –∫–∞–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- `keywords.max_keywords` ‚Üí —Å–∫–æ–ª—å–∫–æ keywords –∏–∑–≤–ª–µ–∫–∞—Ç—å

### 4. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `{text}`, `{platform}`, `{date_range}` **–≤—Å–µ–≥–¥–∞** –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π.

---

**–î–ª—è Scenario #10**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–ü–û–õ–ù–´–ô –ø—Ä–æ–º–ø—Ç** –∏–∑ `SCENARIO_10_QUICK_COPY_PASTE.md`, –≥–¥–µ –≤—Å–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è (`events`, `statistics`) —É–∫–∞–∑–∞–Ω—ã —Ä—É–∫–∞–º–∏!

**–ê–≤—Ç–æ—Ä**: Factory Droid  
**–î–∞—Ç–∞**: Current Session
